syntax = "proto3";
package worker_2_controller_service;
option go_package = "script/rpc_server/worker;worker_2_controller_service";

message RegistRequest {
  string worker_id = 1;
  string password = 2;
}

message RegistResponse {
  bool success = 1;
  string secret = 2;
}

service Worker2Controller {
  rpc RegistWorker(RegistRequest) returns (RegistResponse);
  rpc Hearting(HeartingRequest) returns (HeartingResponse);
  rpc ReportTaskStatus(TaskReportRequest) returns (TaskReportResponse);
}

message Task{
  int32 task_type = 1;
  int32 task_level = 2;
  int32 task_priority = 3;
  bytes task_data = 4;
  bool success = 5;
}

message TaskReportRequest {
  string task_port_id = 1;
  repeated Task details = 2;
}

message TaskDistribution {
  string worker_id = 1;
  string task_id = 2;
}

message TaskReportResponse {
  bool received = 1;
  repeated TaskDistribution tasks = 2;
}

message Status {
  float cpu_usage = 1;
  int32 cpu_cores = 2;
  float cpu_frequency = 3;
  float memory_usage = 4;
  float memory_total = 5;
  int32 task_count = 6;
}

message RepeatedStatus {
  repeated Status statuses = 1;
}

message HeartingRequest {
  string ip = 1;
  Status status = 2;
}

message HeartingResponse {
}

